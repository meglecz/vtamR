sample_16S_control <- samples %>%
filter(sample_type == "mock" | sample_type == "negatif") %>%
filter(marker=="16S1") %>%
filter(run != "Bqt1")
readcount_control_16S <- asvtble_16S %>%
select(sample_16S_control$sample) %>%
sample_coi_control <- samples %>%
filter(sample_type == "mock" | sample_type == "negatif") %>%
filter(marker=="IIICBR")
readcount_control_16S <- asvtble_16S %>%
select(sample_16S_control$sample) %>%
sample_coi_control <- samples %>%
filter(sample_type == "mock" | sample_type == "negatif") %>%
filter(marker=="IIICBR")
readcount_control_16S <- asvtble_16S %>%
select(sample_16S_control$sample)
colnames(asvtble_16S)
readcount_control_16S <- asvtble_16S %>%
select(sample_16S_control$sample)
samples <- read.table("/home/meglecz/vtam_EPI_Nextseq_2024_06/2024_06_25_unser_input/sample_types_Epi.tsv", sep="\t", header=TRUE)
colnames(samples)
samples$sample <- paste(samples$run, samples$sample.final.Emese.Cecile, sep='.')
sample_16S_control <- samples %>%
filter(sample_type == "mock" | sample_type == "negatif") %>%
filter(marker=="16S1") %>%
filter(run != "Bqt1")
readcount_control_16S <- asvtble_16S %>%
select(sample_16S_control$sample)
View(readcount_control_16S)
View(asvtble_16S)
tax_16S <- read.table("/home/meglecz/vtam_EPI_Nextseq_2024_06/2024_06_25_doc_and_sum/asv_tables/pooled/taxassign/pooled_asvtable_EPI_16S1_2024-07-01-14-19-17_RDP_homogenized_taxa.tsv", sep="\t", header=TRUE)
colnames(tax_16S)
asvtable_16S <- read.table("/home/meglecz/vtam_EPI_Nextseq_2024_06/2024_06_25_doc_and_sum/asv_tables/pooled/pooled_asvtable_EPI_16S1_2024-07-01-14-19-17.tsv", sep="\t", header=TRUE)
colnames(asvtable_16S)
tmp <- asvtable_16S %>%
select(-marker, -sequnece_length, -read_count, -sample_count, -runs )
print(colnames(tmp))
tmp <- asvtable_16S %>%
select(-marker, -sequnece_length, -read_count, -sample_count, -runs )
tax_16S <- read.table("/home/meglecz/vtam_EPI_Nextseq_2024_06/2024_06_25_doc_and_sum/asv_tables/pooled/taxassign/pooled_asvtable_EPI_16S1_2024-07-01-14-19-17_RDP_homogenized_taxa.tsv", sep="\t", header=TRUE)
colnames(tax_16S)
asvtable_16S <- read.table("/home/meglecz/vtam_EPI_Nextseq_2024_06/2024_06_25_doc_and_sum/asv_tables/pooled/pooled_asvtable_EPI_16S1_2024-07-01-14-19-17.tsv", sep="\t", header=TRUE)
colnames(asvtable_16S)
tmp <- asvtable_16S %>%
select(-marker, -sequnece_length, -read_count, -sample_count, -runs )
tmp <- asvtable_16S %>%
select(-marker, -sequence_length, -read_count, -sample_count, -runs )
print(colnames(tmp))
length(colnames(tmp))
colnames(tmp)[1000-1324]
colnames(tmp)[1324]
colnames(tmp)[1323]
colnames(tmp)[1322]
tmp <- asvtable_16S %>%
select(-marker, -sequence_length, -read_count, -sample_count, -runs, -sequence, -clustersize, -clusterid_3 )
length(colnames(tmp))
colnames(tmp)[1321]
colnames(tmp)
asvlong_16S <- tmp %>%
pivot_longer(names_to = "sample", values_to = "read_count",)
asvlong_16S <- tmp %>%
pivot_longer(cols != "variant", names_to = "sample", values_to = "read_count",)
asvlong_16S <- tmp %>%
pivot_longer(cols = !starts_with("variant"), names_to = "sample", values_to = "read_count",)
View(asvlong_16S)
asvlong_16S <- tmp %>%
pivot_longer(cols = !starts_with("variant"), names_to = "sample", values_to = "read_count") %>%
filter(read_count>0)
asvlong_16S <- tmp %>%
pivot_longer(cols = !starts_with("variant"), names_to = "sample", values_to = "read_count") %>%
filter(read_count>0) %>%
separate(sample, into =c("run","sample_short"), sep="\\.")
asvlong_16S <- tmp %>%
pivot_longer(cols = !starts_with("variant"), names_to = "sample", values_to = "read_count") %>%
filter(read_count>0)
asvtbl16S[EPI15.s08_21_Che_2406_5.1]
asvtabl16S[EPI15.s08_21_Che_2406_5.1]
asvtable16S[EPI15.s08_21_Che_2406_5.1]
asvtable_16S[EPI15.s08_21_Che_2406_5.1]
asvtable_16S[EPI15.s08_21_Che_2406_5_1]
asvtable_16S[EPI15.s08_21_Che_2406_5]
asvtable_16S[EPI15.s08_21_Che_2406_5 1]
asvtable_16S["EPI15.s08_21_Che_2406_5 1"]
getwd()
colnames(asvtable_16S) > temp.txt
write.csv(colnames(asvtable_16S), file="tmp.txt")
tax_16S <- read.table("/home/meglecz/vtam_EPI_Nextseq_2024_06/2024_06_25_doc_and_sum/asv_tables/pooled/taxassign/pooled_asvtable_EPI_16S1_2024-07-01-14-19-17_RDP_homogenized_taxa.tsv", sep="\t", header=TRUE, check.names = FALSE)
colnames(tax_16S)
asvtable_16S <- read.table("/home/meglecz/vtam_EPI_Nextseq_2024_06/2024_06_25_doc_and_sum/asv_tables/pooled/pooled_asvtable_EPI_16S1_2024-07-01-14-19-17.tsv", sep="\t", header=TRUE, check.names = FALSE)
colnames(asvtable_16S)
# keep only samples and variant
tmp <- asvtable_16S %>%
select(-marker, -sequence_length, -read_count, -sample_count, -runs, -sequence, -clustersize, -clusterid_3 )
length(colnames(tmp))
asvlong_16S <- tmp %>%
pivot_longer(cols = !starts_with("variant"), names_to = "sample", values_to = "read_count") %>%
filter(read_count>0) %>%
separate(sample, into =c("run","sample_short"), sep="\\-")
samples <- read.table("/home/meglecz/vtam_EPI_Nextseq_2024_06/2024_06_25_unser_input/sample_types_Epi.tsv", sep="\t", header=TRUE)
colnames(samples)
View(asvtable_16S)
samples$sample <- paste(samples$run, samples$sample.final.Emese.Cecile, sep='-')
sample_16S_control <- samples %>%
filter(sample_type == "mock" | sample_type == "negatif") %>%
filter(marker=="16S1") %>%
filter(run != "Bqt1")
tax_16S <- read.table("/home/meglecz/vtam_EPI_Nextseq_2024_06/2024_06_25_doc_and_sum/asv_tables/pooled/taxassign/pooled_asvtable_EPI_16S1_2024-07-01-14-19-17_RDP_homogenized_taxa.tsv", sep="\t", header=TRUE, check.names = FALSE)
colnames(tax_16S)
asvtable_16S <- read.table("/home/meglecz/vtam_EPI_Nextseq_2024_06/2024_06_25_doc_and_sum/asv_tables/pooled/pooled_asvtable_EPI_16S1_2024-07-01-14-19-17.tsv", sep="\t", header=TRUE, check.names = FALSE)
colnames(asvtable_16S)
# keep only samples and variant
tmp <- asvtable_16S %>%
select(-marker, -sequence_length, -read_count, -sample_count, -runs, -sequence, -clustersize, -clusterid_3 )
length(colnames(tmp))
asvlong_16S <- tmp %>%
pivot_longer(cols = !starts_with("variant"), names_to = "sample", values_to = "read_count") %>%
filter(read_count>0) %>%
separate(sample, into =c("run","sample_short"), sep="\\-")
samples <- read.table("/home/meglecz/vtam_EPI_Nextseq_2024_06/2024_06_25_unser_input/sample_types_Epi.tsv", sep="\t", header=TRUE, check.names = FALSE)
View(samples)
# keep only samples and variant
tmp <- asvtable_16S %>%
select(-marker, -sequence_length, -read_count, -sample_count, -runs, -sequence, -clustersize, -clusterid_3 )
length(colnames(tmp))
asvlong_16S <- tmp %>%
pivot_longer(cols = !starts_with("variant"), names_to = "sample", values_to = "read_count") %>%
filter(read_count>0) %>%
separate(sample, into =c("run","sample_short"), sep="\\-")
t <- colnames(samples)
t[2]  <- "sample"
t
colnames(samples) <- t
samples <- read.table("/home/meglecz/vtam_EPI_Nextseq_2024_06/2024_06_25_unser_input/sample_types_Epi.tsv", sep="\t", header=TRUE, check.names = FALSE)
colnames(samples)
samples <- samples %>%
rename("sample" = "sample final Emese Cecile")
samples <- read.table("/home/meglecz/vtam_EPI_Nextseq_2024_06/2024_06_25_unser_input/sample_types_Epi.tsv", sep="\t", header=TRUE, check.names = FALSE)
samples <- samples %>%
rename("sample" = "sample final Emese Cecile")
# keep only samples and variant
tmp <- asvtable_16S %>%
select(-marker, -sequence_length, -read_count, -sample_count, -runs, -sequence, -clustersize, -clusterid_3 )
length(colnames(tmp))
asvlong_16S <- tmp %>%
pivot_longer(cols = !starts_with("variant"), names_to = "sample", values_to = "read_count") %>%
filter(read_count>0) %>%
separate(sample, into =c("run","sample_short"), sep="\\-")
View(asvlong_16S)
asvlong_16S <- left_join(asvlong_16S, samples, by=c("sample_short"="sample"))
samples <- read.table("/home/meglecz/vtam_EPI_Nextseq_2024_06/2024_06_25_unser_input/sample_types_Epi.tsv", sep="\t", header=TRUE, check.names = FALSE)
samples <- samples %>%
rename("sample" = "sample final Emese Cecile") %>%
filter(marker="16S1")
samples <- samples %>%
rename("sample" = "sample final Emese Cecile") %>%
filter(marker=="16S1")
# keep only samples and variant
tmp <- asvtable_16S %>%
select(-marker, -sequence_length, -read_count, -sample_count, -runs, -sequence, -clustersize, -clusterid_3 )
length(colnames(tmp))
asvlong_16S <- tmp %>%
pivot_longer(cols = !starts_with("variant"), names_to = "sample", values_to = "read_count") %>%
filter(read_count>0) %>%
separate(sample, into =c("run","sample_short"), sep="\\-")
asvlong_16S <- left_join(asvlong_16S, samples, by=c("sample_short"="sample"))
tax_16S <- read.table("/home/meglecz/vtam_EPI_Nextseq_2024_06/2024_06_25_doc_and_sum/asv_tables/pooled/taxassign/pooled_asvtable_EPI_16S1_2024-07-01-14-19-17_RDP_homogenized_taxa.tsv", sep="\t", header=TRUE, check.names = FALSE)
colnames(tax_16S)
asvtable_16S <- read.table("/home/meglecz/vtam_EPI_Nextseq_2024_06/2024_06_25_doc_and_sum/asv_tables/pooled/pooled_asvtable_EPI_16S1_2024-07-01-14-19-17.tsv", sep="\t", header=TRUE, check.names = FALSE)
colnames(asvtable_16S)
samples <- read.table("/home/meglecz/vtam_EPI_Nextseq_2024_06/2024_06_25_unser_input/sample_types_Epi.tsv", sep="\t", header=TRUE, check.names = FALSE)
samples <- samples %>%
rename("sample" = "sample final Emese Cecile") %>%
filter(marker=="16S1")
# keep only samples and variant
tmp <- asvtable_16S %>%
select(-marker, -sequence_length, -read_count, -sample_count, -runs, -sequence, -clustersize, -clusterid_3 )
asvlong_16S <- tmp %>%
pivot_longer(cols = !starts_with("variant"), names_to = "sample", values_to = "read_count") %>%
filter(read_count>0) %>%
separate(sample, into =c("run","sample_short"), sep="\\-")
asvlong_16S <- left_join(asvlong_16S, samples, by=c("sample_short"="sample", "run"="run"))
asvtable_16S <- read.table("/home/meglecz/vtam_EPI_Nextseq_2024_06/2024_06_25_doc_and_sum/asv_tables/pooled/pooled_asvtable_EPI_16S1_2024-07-01-14-19-17.tsv", sep="\t", header=TRUE, check.names = FALSE)
colnames(asvtable_16S)
# keep only samples and variant
asvlong_16S <- asvtable_16S %>%
select(-marker, -sequence_length, -read_count, -sample_count, -runs, -sequence, -clustersize, -clusterid_3 ) %>%
pivot_longer(cols = !starts_with("variant"), names_to = "sample", values_to = "read_count") %>%
filter(read_count>0) %>%
separate(sample, into =c("run","sample_short"), sep="\\-")
asvlong_16S <- left_join(asvlong_16S, samples, by=c("sample_short"="sample", "run"="run")) %>%
select(-SampleID)
tax_16S <- read.table("/home/meglecz/vtam_EPI_Nextseq_2024_06/2024_06_25_doc_and_sum/asv_tables/pooled/taxassign/pooled_asvtable_EPI_16S1_2024-07-01-14-19-17_RDP_homogenized_taxa.tsv", sep="\t", header=TRUE, check.names = FALSE)
samples <- read.table("/home/meglecz/vtam_EPI_Nextseq_2024_06/2024_06_25_unser_input/sample_types_Epi.tsv", sep="\t", header=TRUE, check.names = FALSE)
samples_16S <- samples %>%
rename("sample" = "sample final Emese Cecile") %>%
filter(marker=="16S1")
sample_16S_control <- samples %>%
filter(sample_type == "mock" | sample_type == "negatif")
View(sample_16S_control)
sample_16S_control <- samples_16S %>%
filter(sample_type == "mock" | sample_type == "negatif")
asvlong_16S_contol <- asvlong_16S %>%
filter(sample %in% sample_16S_control$sample)
# get taxonomy
tax_16S <- read.table("/home/meglecz/vtam_EPI_Nextseq_2024_06/2024_06_25_doc_and_sum/asv_tables/pooled/taxassign/pooled_asvtable_EPI_16S1_2024-07-01-14-19-17_RDP_homogenized_taxa.tsv", sep="\t", header=TRUE, check.names = FALSE)
# get 16S samles
samples <- read.table("/home/meglecz/vtam_EPI_Nextseq_2024_06/2024_06_25_unser_input/sample_types_Epi.tsv", sep="\t", header=TRUE, check.names = FALSE)
samples_16S <- samples %>%
rename("sample" = "sample final Emese Cecile") %>%
filter(marker=="16S1")
# read asvtable
asvtable_16S <- read.table("/home/meglecz/vtam_EPI_Nextseq_2024_06/2024_06_25_doc_and_sum/asv_tables/pooled/pooled_asvtable_EPI_16S1_2024-07-01-14-19-17.tsv", sep="\t", header=TRUE, check.names = FALSE)
# transform asvtable to long format
asvlong_16S <- asvtable_16S %>%
select(-marker, -sequence_length, -read_count, -sample_count, -runs, -sequence, -clustersize, -clusterid_3 ) %>%
pivot_longer(cols = !starts_with("variant"), names_to = "sample", values_to = "read_count") %>%
filter(read_count>0) %>%
separate(sample, into =c("run","sample_short"), sep="\\-")
# add sample type info to asvlong_16S
asvlong_16S <- left_join(asvlong_16S, samples, by=c("sample_short"="sample", "run"="run")) %>%
select(-SampleID)
sample_16S_control <- samples_16S %>%
filter(sample_type == "mock" | sample_type == "negatif")
# get taxonomy
tax_16S <- read.table("/home/meglecz/vtam_EPI_Nextseq_2024_06/2024_06_25_doc_and_sum/asv_tables/pooled/taxassign/pooled_asvtable_EPI_16S1_2024-07-01-14-19-17_RDP_homogenized_taxa.tsv", sep="\t", header=TRUE, check.names = FALSE)
# get 16S samles
samples <- read.table("/home/meglecz/vtam_EPI_Nextseq_2024_06/2024_06_25_unser_input/sample_types_Epi.tsv", sep="\t", header=TRUE, check.names = FALSE)
samples_16S <- samples %>%
rename("sample" = "sample final Emese Cecile") %>%
filter(marker=="16S1")
# read asvtable
asvtable_16S <- read.table("/home/meglecz/vtam_EPI_Nextseq_2024_06/2024_06_25_doc_and_sum/asv_tables/pooled/pooled_asvtable_EPI_16S1_2024-07-01-14-19-17.tsv", sep="\t", header=TRUE, check.names = FALSE)
# transform asvtable to long format
asvlong_16S <- asvtable_16S %>%
select(-marker, -sequence_length, -read_count, -sample_count, -runs, -sequence, -clustersize, -clusterid_3 ) %>%
pivot_longer(cols = !starts_with("variant"), names_to = "sample", values_to = "read_count") %>%
filter(read_count>0) %>%
separate(sample, into =c("run","sample_short"), sep="\\-")
# add sample type info to asvlong_16S
asvlong_16S <- left_join(asvlong_16S, samples, by=c("sample_short"="sample", "run"="run")) %>%
select(-SampleID)
# transform asvtable to long format
asvlong_16S <- asvtable_16S %>%
select(-marker, -sequence_length, -read_count, -sample_count, -runs, -sequence, -clustersize, -clusterid_3 ) %>%
pivot_longer(cols = !starts_with("variant"), names_to = "sample", values_to = "read_count") %>%
filter(read_count>0) %>%
separate(sample, into =c("run","sample_short"), sep="\\-")
View(asvlong_16S)
# add sample type info to asvlong_16S
asvlong_16S <- left_join(asvlong_16S, asvtable_16S, by=c("sample_short"="sample", "run"="run")) %>%
select(-SampleID)
# get taxonomy
tax_16S <- read.table("/home/meglecz/vtam_EPI_Nextseq_2024_06/2024_06_25_doc_and_sum/asv_tables/pooled/taxassign/pooled_asvtable_EPI_16S1_2024-07-01-14-19-17_RDP_homogenized_taxa.tsv", sep="\t", header=TRUE, check.names = FALSE)
# get 16S samles
samples <- read.table("/home/meglecz/vtam_EPI_Nextseq_2024_06/2024_06_25_unser_input/sample_types_Epi.tsv", sep="\t", header=TRUE, check.names = FALSE)
samples_16S <- samples %>%
rename("sample" = "sample final Emese Cecile") %>%
filter(marker=="16S1")
View(samples)
View(samples_16S)
# read asvtable
asvtable_16S <- read.table("/home/meglecz/vtam_EPI_Nextseq_2024_06/2024_06_25_doc_and_sum/asv_tables/pooled/pooled_asvtable_EPI_16S1_2024-07-01-14-19-17.tsv", sep="\t", header=TRUE, check.names = FALSE)
# transform asvtable to long format
asvlong_16S <- asvtable_16S %>%
select(-marker, -sequence_length, -read_count, -sample_count, -runs, -sequence, -clustersize, -clusterid_3 ) %>%
pivot_longer(cols = !starts_with("variant"), names_to = "sample", values_to = "read_count") %>%
filter(read_count>0) %>%
separate(sample, into =c("run","sample_short"), sep="\\-")
View(asvlong_16S)
# add sample type info to asvlong_16S
asvlong_16S <- left_join(asvlong_16S, samples_16S, by=c("sample_short"="sample", "run"="run")) %>%
select(-SampleID)
sample_16S_control <- samples_16S %>%
filter(sample_type == "mock" | sample_type == "negatif")
View(sample_16S_control)
asvlong_16S_contol <- asvlong_16S %>%
filter(sample %in% sample_16S_control$sample)
asvlong_16S_contol <- asvlong_16S %>%
filter(sample_type == "mock" | sample_type == "negatif")
View(asvlong_16S_contol)
asvlong_16S_contol <- asvlong_16S %>%
filter(sample_type == "negatif")
sum_variant_run <- asvlong_16S %>%
group_by(variant, run) %>%
summarise("read_count_var_run"=sum(read_count))
View(sum_variant_run)
View(asvlong_16S_contol)
asvlong_16S_contol <- left_join(asvlong_16S_contol, sum_variant_run, by=c("variant","run"))
asvlong_16S_contol$sample_to_all <- asvlong_16S_contol$read_count/asvlong_16S_contol$sum_variant_run
asvlong_16S_contol$sample_to_all <- asvlong_16S_contol$read_count/asvlong_16S_contol$read_count_var_run
sum_variant_run_sample_type <- asvlong_16S %>%
group_by(variant, run, sample_type) %>%
summarise("read_count_var_run_st"=sum(read_count))
View(sum_variant_run_sample_type)
#######
asvlong_16S_contol <- asvlong_16S %>%
filter(sample_type == "negatif")
sum_variant_run_sample_type <- asvlong_16S %>%
group_by(variant, run, sample_type) %>%
summarise("read_count_var_run_st"=sum(read_count))
asvlong_16S_contol <- left_join(asvlong_16S_contol, sum_variant_run_sample_type, by=c("variant","run", "sample_type"))
asvlong_16S_contol$sample_type_to_all <- asvlong_16S_contol$read_count/asvlong_16S_contol$read_count_var_run_st
library(dada2)
packageVersion("dada2")
path <-  "/home/meglecz/vtam_data/dada2/1_input_vtam-0.1.12/MFZR_orientation_pooled"
list.files(path)
# Forward and reverse fastq filenames have format: SAMPLENAME_R1_001.fastq and SAMPLENAME_R2_001.fastq
fnFs <- sort(list.files(path, pattern="_fw.fastq", full.names = TRUE))
fnRs <- sort(list.files(path, pattern="_rv.fastq", full.names = TRUE))
# Extract sample names, assuming filenames have format: SAMPLENAME_XXX.fastq
sample.names <- sapply(strsplit(basename(fnFs), "_"), `[`, 1)
plotQualityProfile(fnFs[1:2])
plotQualityProfile(fnFs[3:8])
# Place filtered files in filtered/ subdirectory
filtFs <- file.path(path, "filtered", paste0(sample.names, "_F_filt.fastq.gz"))
filtRs <- file.path(path, "filtered", paste0(sample.names, "_R_filt.fastq.gz"))
names(filtFs) <- sample.names
names(filtRs) <- sample.names
# quality filter
out <- filterAndTrim(fnFs, filtFs, fnRs, filtRs, truncLen=c(160,160),
maxN=0, maxEE=c(2,2), truncQ=2, rm.phix=TRUE,
compress=TRUE, multithread=TRUE) # On Windows set multithread=FALSE
library(dplyr)
orig <- read.table("/home/meglecz/vtam_git/16S/16S_asvtable_TAS1-2_read_counts.tsv", sep="\t", header=TRUE)
orig <- read.table("/home/meglecz/vtam_git/16S/16S_asvtable_TAS1-2_read_counts.tsv", sep="\t", header=TRUE, na.strings = "")
orig <- read.table("/home/meglecz/vtam_git/16S/16S_asvtable_TAS1-2_read_counts.tsv", sep="\t", header=TRUE, na.strings = "", fill=TRUE)
View(orig)
caunt <- read.table("/home/meglecz/vtam_git/16S/SuppMat_16S_WO_tax.csv", sep="\t", header=TRUE, na.strings = "", fill=TRUE)
count <- read.table("/home/meglecz/vtam_git/16S/SuppMat_16S_WO_tax.csv", sep="\t", header=TRUE, na.strings = "", fill=TRUE)
colnames(orig)
orig <- orig %>%
select(1, 152:163)
colnames(orig) <- c("domain", "domain_bootstrap", "phylum", "phylum_bootstrap", "class", "class_bootstrap", "order", "order_bootstrap", "family", "family_bootstrap", "genus", "genus_bootstrap")
colnames(orig) <- c("variant_id", "domain", "domain_bootstrap", "phylum", "phylum_bootstrap", "class", "class_bootstrap", "order", "order_bootstrap", "family", "family_bootstrap", "genus", "genus_bootstrap")
colnames(count)
count <- left_join(count, orig, by="variant_id")
colnames(count)
write.csv2(file="/home/meglecz/vtam_git/16S/SuppMat_VTAM16S_corrected.tsv", count)
write.table(count, file="/home/meglecz/vtam_git/16S/SuppMat_VTAM16S_corrected.tsv", count=FALSE, sep=";", dec=".", row.names=FALSE)
write.table(count, file="/home/meglecz/vtam_git/16S/SuppMat_VTAM16S_corrected.tsv", quote=FALSE, sep=";", dec=".", row.names=FALSE)
bold <- read.table(tsv, sep="\t", header=TRUE, fill=TRUE)
tsv <- "/home/meglecz/mkCOInr/BOLD_2025_02/BOLD_Public.21-Feb-2025.tsv"
bold <- read.table(tsv, sep="\t", header=TRUE, fill=TRUE)
bold <- read.table(tsv, sep="\t", header=TRUE, fill=TRUE)
remove.packages("vtamR")
unlink("~/R/x86_64-pc-linux-gnu-library/4.0/vtamR", recursive = TRUE)
devtools::install()
getwd()
setwd(~/vtamR)
setwd("~/vtamR")
getwd()
devtools::install()
knitr::opts_chunk$set(echo = TRUE, eval=FALSE)
library("vtamR")
library(vtamR)
# Bombyx
cutadapt_path <- "~/miniconda3/envs/vtam/bin/cutadapt" # v3.4
vsearch_path <- "~/miniconda3/envs/vtam/bin/vsearch" # v2.15.1
blast_path <- "~/miniconda3/envs/vtam/bin/blastn" # v2.10.1+
swarm_path <- "swarm" # v2.1.12
num_threads <- 8
sep <- ","
## Bombyx
taxonomy <- "~/mkCOInr/COInr/COInr_for_vtam_2025_05_23_dbV5/COInr_for_vtam_taxonomy.tsv"
blast_db <- "~/mkCOInr/COInr/COInr_for_vtam_2025_05_23_dbV5/COInr_for_vtam"
fastq_dir <- system.file("extdata/demo/fastq", package = "vtamR")
outdir <- "~/vtamR_demo/out_mfzr"
fastqinfo <-  system.file("extdata/demo/fastqinfo_mfzr.csv", package = "vtamR")
mock_composition <-  system.file("extdata/demo/mock_composition_mfzr.csv", package = "vtamR")
asv_list <-  system.file("extdata/demo/asv_list.csv", package = "vtamR")
fastq_dir <- system.file("extdata/demo/fastq", package = "vtamR")
outdir <- "~/vtamR_demo/out_mfzr"
fastqinfo <-  system.file("extdata/demo/fastqinfo_mfzr.csv", package = "vtamR")
mock_composition <-  system.file("extdata/demo/mock_composition_mfzr.csv", package = "vtamR")
asv_list <-  system.file("extdata/demo/asv_list.csv", package = "vtamR")
CheckFileinfo(file=fastqinfo, dir=fastq_dir, file_type="fastqinfo")
CheckFileinfo(file=mock_composition, file_type="mock_composition")
CheckFileinfo(file=asv_list, file_type="asv_list")
stat_df <- data.frame(parameters=character(),
asv_count=integer(),
read_count=integer(),
sample_count=integer(),
sample_replicate_count=integer())
stat_df <- GetStat(read_count_df, stat_df, stage="Input", params=NA)
View(stat_df)
# merge and quality filter
merged_dir <- file.path(outdir, "merged")
fastainfo_df <- Merge(fastqinfo,
fastq_dir=fastq_dir,
vsearch_path=vsearch_path,
outdir=merged_dir
)
# demultiplex, trim tags and pimers
sorted_dir <- file.path(outdir, "sorted")
sortedinfo_df <- SortReads(fastainfo_df,
fasta_dir=merged_dir,
outdir=sorted_dir,
check_reverse=TRUE,
cutadapt_path=cutadapt_path,
vsearch_path=vsearch_path
)
sortedinfo_df
outfile <- file.path(outdir, "1_before_filter.csv")
updated_asv_list <- file.path(outdir, "ASV_list_with_IDs.csv")
read_count_df <- Dereplicate(sortedinfo_df,
dir=sorted_dir,
outfile=outfile,
asv_list=asv_list,
updated_asv_list=updated_asv_list
)
outdir
stat_df <- data.frame(parameters=character(),
asv_count=integer(),
read_count=integer(),
sample_count=integer(),
sample_replicate_count=integer())
stat_df <- GetStat(read_count_df, stat_df, stage="Input", params=NA)
by_sample <- TRUE
outfile <- file.path(outdir, "2_Swarm_by_sample.csv")
read_count_df <- Swarm(read_count_df,
outfile=outfile,
swarm_path=swarm_path,
num_threads=num_threads,
by_sample=by_sample
)
stat_df <- GetStat(read_count_df, stat_df, stage="Swarm", params=by_sample)
print(stat_df)
Histogram_ReadCountByVariant(read_count_df, min_read_count=10, binwidth=1000)
print(stat_df)
Histogram_ReadCountByVariant(read_count_df, min_read_count=10, binwidth=1000)
Histogram_ReadCountByVariant(read_count_df, min_read_count=10, binwidth=1000)
print(stat_df)
Histogram_ReadCountByVariant(read_count_df, min_read_count=10, binwidth=100)
Histogram_ReadCountByVariant(read_count_df, min_read_count=10, binwidth=10)
Histogram_ReadCountByVariant(read_count_df, min_read_count=10, binwidth=100)
?Histogram_ReadCountByVariant
read_count_df %>%
filter(read_count<10) %>%
pull(n)
library(dplyer)
library("dplyr")
read_count_df %>%
filter(read_count<10) %>%
pull(n)
read_count_df %>%
filter(read_count<10) %>%
pull(nrow)
read_count_df %>%
filter(read_count<10)
read_count_df %>%
filter(read_count<10) %>%
nrow()
read_count_df %>%
group_by(asv) %>%
summarize(read_count_asv = sum(read_count)) %>%
filter(read_count_asv<10) %>%
nrow()
global_read_count_cutoff = 2
outfile <- file.path(outdir, "3_LFNglobalReadCount.csv")
read_count_df <- LFNglobalReadCount(read_count_df,
cutoff=global_read_count_cutoff,
outfile=outfile
)
stat_df <- GetStat(read_count_df,
stat_df,
stage="LFNglobalReadCount",
params=global_read_count_cutoff
)
print(stat_df)
outfile <- file.path(outdir, "4_FilterIndel.csv")
read_count_df <- FilterIndel(read_count_df, outfile=outfile)
stat_df <- GetStat(read_count_df, stat_df, stage="FilterIndel")
print(stat_df)
outfile <- file.path(outdir, "5_FilterCodonStop.csv")
genetic_code = 5
read_count_df <- FilterCodonStop(read_count_df, outfile=outfile, genetic_code=genetic_code)
stat_df <- GetStat(read_count_df, stat_df, stage="FilerCodonStop", params=genetic_code)
print(stat_df)
abskew=2
by_sample = T
sample_prop = 0.8
outfile <- file.path(outdir, "6_FilterChimera.csv")
read_count_df <- FilterChimera(read_count_df, outfile=outfile, vsearch_path=vsearch_path, by_sample=by_sample, sample_prop=sample_prop, abskew=abskew)
params <- paste(abskew, by_sample, sample_prop, sep=";")
stat_df <- GetStat(read_count_df, stat_df, stage="FilterChimera", params=params)
print(stat_df)
# calculate renkonen distance among all replicates within sample
renkonen_within_df <- MakeRenkonenDistances(read_count_df, compare_all=FALSE)
# density plot
renkonen_density_plot <- DensityPlot_RenkonenDistance(renkonen_within_df)
print(renkonen_density_plot)
# barplot
sortedinfo <- file.path(sorted_dir, "sortedinfo.csv")
renkonen_barplot <- Barplot_RenkonenDistance(renkonen_within_df, sample_types=sortedinfo, x_axis_label_size=6)
print(renkonen_barplot)
outfile <- file.path(outdir, "7_FilterRenkonen.csv")
cutoff <- 0.4
read_count_df <- FilterRenkonen(read_count_df, outfile=outfile, cutoff=cutoff)
stat_df <- GetStat(read_count_df, stat_df, stage="FilerRenkonen", params=cutoff)
print(stat_df)
devtools::build_vignettes()
devtools::build_vignettes()
devtools::build_vignettes()
devtools::build_vignettes()
vignette(package = "vtamR")
?PoolReplicates
devtools::build_vignettes()
devtools::build_vignettes()
devtools::build_vignettes()
devtools::build_vignettes()
devtools::build_vignettes()
devtools::build_vignettes()
